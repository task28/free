<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Page 2</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #eef2f3; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        /* Information Section */
        .info-box { background: #e8f5e9; border-left: 5px solid #4caf50; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .info-box h3 { margin: 0 0 5px; color: #2e7d32; }
        .info-box p { margin: 0; font-size: 13px; color: #555; }

        /* Ads Container */
        .ad-slot { 
            width: 100%; min-height: 60px; background: #fafafa; 
            margin: 15px 0; border: 1px dashed #ccc; border-radius: 8px; 
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }

        /* Buttons */
        .task-btn {
            width: 100%; padding: 14px; background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;
            margin-bottom: 10px; transition: 0.3s;
        }
        .task-btn:disabled { background: #cfd8dc; cursor: not-allowed; color: #888; }
        .task-btn.completed { background: #4caf50; pointer-events: none; }

        .next-btn {
            display: none; width: 100%; padding: 15px; background: #e74c3c; color: white;
            border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="info-box">
        <h3>üöÄ SEO & Content Tips</h3>
        <p>Content marketing is a strategic approach focused on creating and distributing valuable content to attract a defined audience.</p>
    </div>

    <div id="content-area">Loading Page 2 Tasks...</div>

    <button id="next-page-btn" class="next-btn" onclick="goNext()">Go to Page 3 ‚û°</button>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAa_T9MDAjSjQ4Us8C4O6Lqzus2d1_LRck",
    authDomain: "task-310c5.firebaseapp.com",
    projectId: "task-310c5",
    storageBucket: "task-310c5.firebasestorage.app",
    messagingSenderId: "503757001786",
    appId: "1:503757001786:web:3ba0943c3367c273de9103"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  
  // ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤
  let activeTaskNum = null;
  let taskStartTime = 0;
  const REQUIRED_TIME = 10; // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶Æ‡ßü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã

  // ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° (Page 2 ‡¶•‡ßá‡¶ï‡ßá)
  get(child(ref(db), 'admin_settings/page_2')).then((snapshot) => {
      const container = document.getElementById('content-area');
      container.innerHTML = "";
      
      const data = snapshot.val() || {};

      for (let i = 1; i <= 10; i++) {
          const link = data[`link_${i}`] || "#";
          const adScript = data[`ad_${i}`] || "";

          // ‡ßß. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶∏‡ßç‡¶≤‡¶ü
          const adDiv = document.createElement('div');
          adDiv.className = 'ad-slot';
          container.appendChild(adDiv);

          // ‡ß®. ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶∞‡¶æ‡¶®
          if (adScript) {
              adDiv.innerHTML = adScript;
              executeScript(adDiv);
          } else {
              adDiv.innerHTML = "<small>Ad Area</small>";
          }

          // ‡ß©. ‡¶¨‡¶æ‡¶ü‡¶®
          const btn = document.createElement('button');
          btn.innerText = `Visit Site ${i}`;
          btn.className = 'task-btn';
          btn.id = `btn-${i}`;
          
          // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
          btn.onclick = function() { startTask(i, link); };
          
          if (i > 1) btn.disabled = true;
          container.appendChild(btn);
      }
  });

  // ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶è‡¶ï‡ßç‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∂‡¶®
  function executeScript(element) {
      const scripts = element.querySelectorAll("script");
      scripts.forEach((oldScript) => {
          const newScript = document.createElement("script");
          Array.from(oldScript.attributes).forEach(attr => {
              newScript.setAttribute(attr.name, attr.value);
          });
          newScript.appendChild(document.createTextNode(oldScript.innerHTML));
          oldScript.parentNode.replaceChild(newScript, oldScript);
      });
  }

  // --- ‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ---

  // ‡ßß. ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  window.startTask = function(num, url) {
      if(url === "#" || !url) { alert("Link not set by admin!"); return; }

      // ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ì‡¶™‡ßá‡¶® ‡¶ï‡¶∞‡¶æ
      window.open(url, '_blank');

      // ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ
      activeTaskNum = num;
      taskStartTime = Date.now(); // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶Æ‡ßü ‡¶®‡ßã‡¶ü ‡¶ï‡¶∞‡¶æ

      const btn = document.getElementById(`btn-${num}`);
      btn.innerText = "Checking... Wait 10s";
      btn.disabled = true; // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤ ‡¶∞‡¶æ‡¶ñ‡¶æ
  }

  // ‡ß®. ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡¶ñ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá (Visibility Change Event)
  document.addEventListener("visibilitychange", () => {
      // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶π‡ßü ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶è‡¶ï‡¶ü‡¶ø‡¶≠ ‡¶•‡¶æ‡¶ï‡ßá
      if (document.visibilityState === "visible" && activeTaskNum !== null) {
          checkResult();
      }
  });

  // ‡ß©. ‡¶∏‡¶Æ‡ßü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  function checkResult() {
      const currentTime = Date.now();
      const timeSpent = (currentTime - taskStartTime) / 1000; // ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞
      const btn = document.getElementById(`btn-${activeTaskNum}`);

      if (timeSpent >= REQUIRED_TIME) {
          // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡¶≤‡ßá -> Success
          btn.innerText = "Completed ‚úî";
          btn.classList.add("completed");

          // ‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶®‡¶≤‡¶ï
          if (activeTaskNum < 10) {
              const nextBtn = document.getElementById(`btn-${activeTaskNum + 1}`);
              if(nextBtn) nextBtn.disabled = false;
          } else {
              // ‡¶∏‡¶¨ ‡¶∂‡ßá‡¶∑ ‡¶π‡¶≤‡ßá ‡¶®‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶™‡ßá‡¶ú ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∂‡ßã
              document.getElementById('next-page-btn').style.display = 'block';
          }
      } else {
          // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶π‡¶≤‡ßá -> Fail
          alert(`You came back too early! You stayed only ${Math.floor(timeSpent)} seconds. Please wait 10 seconds.`);
          
          // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü (‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá)
          btn.innerText = `Visit Site ${activeTaskNum}`;
          btn.classList.remove("completed");
          btn.disabled = false;
      }

      // ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
      activeTaskNum = null;
      taskStartTime = 0;
  }

  // Next Page Function
  window.goNext = function() {
      window.location.href = "page3.html";
  }
</script>

</body>
</html>
