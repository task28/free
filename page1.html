<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Page 1</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; background: white; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        
        /* Information Section */
        .info-box { background: #e3f2fd; border-left: 5px solid #2196f3; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .info-box h3 { margin: 0 0 5px; color: #1565c0; }
        .info-box p { margin: 0; font-size: 13px; color: #555; }

        /* Ads Container */
        .ad-slot { 
            width: 100%; min-height: 60px; background: #fafafa; 
            margin: 15px 0; border: 1px dashed #ccc; border-radius: 8px; 
            display: flex; justify-content: center; align-items: center; overflow: hidden;
        }

        /* Buttons */
        .task-btn {
            width: 100%; padding: 14px; background: linear-gradient(to right, #4facfe, #00f2fe);
            color: white; border: none; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer;
            margin-bottom: 10px; transition: 0.3s;
        }
        .task-btn:disabled { background: #cfd8dc; cursor: not-allowed; color: #888; }
        .task-btn.completed { background: #2ecc71; pointer-events: none; }

        .next-btn {
            display: none; width: 100%; padding: 15px; background: #ff5722; color: white;
            border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer; margin-top: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="info-box">
        <h3>üì¢ Marketing Tips</h3>
        <p>Affiliate marketing involves earning a commission by promoting a product or service made by another retailer or advertiser.</p>
    </div>

    <div id="content-area">Loading Tasks...</div>

    <button id="next-page-btn" class="next-btn" onclick="goNext()">Next Page ‚û°</button>
</div>

<!-- Firebase SDK -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
  import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAa_T9MDAjSjQ4Us8C4O6Lqzus2d1_LRck",
    authDomain: "task-310c5.firebaseapp.com",
    projectId: "task-310c5",
    storageBucket: "task-310c5.firebasestorage.app",
    messagingSenderId: "503757001786",
    appId: "1:503757001786:web:3ba0943c3367c273de9103"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  
  // ‡¶≠‡ßá‡¶∞‡¶ø‡ßü‡ßá‡¶¨‡¶≤ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  let activeTaskNum = null;
  let taskStartTime = 0;
  const REQUIRED_TIME = 10; // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£

  // ‡¶°‡ßá‡¶ü‡¶æ ‡¶≤‡ßã‡¶° ‡¶è‡¶¨‡¶Ç ‡¶™‡ßá‡¶ú ‡¶∏‡¶æ‡¶ú‡¶æ‡¶®‡ßã
  get(child(ref(db), 'admin_settings/page_1')).then((snapshot) => {
      const container = document.getElementById('content-area');
      container.innerHTML = "";
      
      const data = snapshot.val() || {};

      for (let i = 1; i <= 10; i++) {
          const link = data[`link_${i}`] || "#";
          const adScript = data[`ad_${i}`] || "";

          // ‡ßß. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶°‡¶ø‡¶≠ ‡¶§‡ßà‡¶∞‡¶ø
          const adDiv = document.createElement('div');
          adDiv.className = 'ad-slot';
          container.appendChild(adDiv);

          // ‡ß®. ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ‡¶®‡ßã
          if (adScript) {
              adDiv.innerHTML = adScript; 
              executeScript(adDiv);
          } else {
              adDiv.innerHTML = "<small>Ad Area</small>";
          }

          // ‡ß©. ‡¶¨‡¶æ‡¶ü‡¶® ‡¶§‡ßà‡¶∞‡¶ø
          const btn = document.createElement('button');
          btn.innerText = `Visit Site ${i}`;
          btn.className = 'task-btn';
          btn.id = `btn-${i}`;
          
          // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶á‡¶≠‡ßá‡¶®‡ßç‡¶ü ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ (‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶ï‡¶≤ ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá Event Listener ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶≠‡¶æ‡¶≤‡ßã)
          btn.onclick = function() { startTask(i, link); };
          
          if (i > 1) btn.disabled = true; 
          container.appendChild(btn);
      }
  });

  function executeScript(element) {
      const scripts = element.querySelectorAll("script");
      scripts.forEach((oldScript) => {
          const newScript = document.createElement("script");
          Array.from(oldScript.attributes).forEach(attr => {
              newScript.setAttribute(attr.name, attr.value);
          });
          newScript.appendChild(document.createTextNode(oldScript.innerHTML));
          oldScript.parentNode.replaceChild(newScript, oldScript);
      });
  }

  // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  window.startTask = function(num, url) {
      if(url === "#" || !url) { alert("Link not set by admin!"); return; }

      // ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ì‡¶™‡ßá‡¶®
      window.open(url, '_blank');

      // ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∂‡ßÅ‡¶∞‡ßÅ
      activeTaskNum = num;
      taskStartTime = Date.now(); // ‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶® ‡¶∏‡¶Æ‡ßü ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ

      const btn = document.getElementById(`btn-${num}`);
      btn.innerText = "Checking... Wait 10s";
      btn.disabled = true; // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶°‡¶ø‡¶ú‡ßá‡¶¨‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶§‡ßá ‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá
  }

  // ‡¶Ø‡¶ñ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ü‡¶∏‡¶¨‡ßá ‡¶§‡¶ñ‡¶® ‡¶ö‡ßá‡¶ï ‡¶π‡¶¨‡ßá
  document.addEventListener("visibilitychange", () => {
      // ‡¶Ø‡¶¶‡¶ø ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨ ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® ‡¶π‡ßü (User back ‡¶è‡¶∏‡ßá‡¶õ‡ßá) ‡¶è‡¶¨‡¶Ç ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶•‡¶æ‡¶ï‡ßá
      if (document.visibilityState === "visible" && activeTaskNum !== null) {
          checkTimeAndResult();
      }
  });

  function checkTimeAndResult() {
      const currentTime = Date.now();
      const timeDiff = (currentTime - taskStartTime) / 1000; // ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá ‡¶∞‡ßÇ‡¶™‡¶æ‡¶®‡ßç‡¶§‡¶∞
      const btn = document.getElementById(`btn-${activeTaskNum}`);

      if (timeDiff >= REQUIRED_TIME) {
          // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ ‡¶§‡¶æ‡¶∞ ‡¶¨‡ßá‡¶∂‡¶ø ‡¶π‡ßü‡ßá‡¶õ‡ßá -> SUCCESS
          btn.innerText = "Completed ‚úî";
          btn.classList.add("completed");
          
          // ‡¶™‡¶∞‡ßá‡¶∞ ‡¶¨‡¶æ‡¶ü‡¶® ‡¶Ü‡¶®‡¶≤‡¶ï
          if (activeTaskNum < 10) {
              const nextBtn = document.getElementById(`btn-${activeTaskNum + 1}`);
              if(nextBtn) nextBtn.disabled = false;
          } else {
              document.getElementById('next-page-btn').style.display = 'block';
          }
      } else {
          // ‡ßß‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶ï‡¶Æ ‡¶π‡ßü‡ßá‡¶õ‡ßá -> FAIL
          alert(`You came back too early! Please wait ${REQUIRED_TIME} seconds on the site.`);
          
          // ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
          btn.innerText = `Visit Site ${activeTaskNum}`;
          btn.classList.remove("completed");
          btn.disabled = false; // ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶Ø‡ßã‡¶ó ‡¶¶‡ßá‡¶ì‡ßü‡¶æ
      }

      // ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü
      activeTaskNum = null;
      taskStartTime = 0;
  }

  window.goNext = function() {
      window.location.href = "page2.html";
  }
</script>

</body>
</html>
